
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Custom Operator Generation System">
      
      
      
      
        <link rel="prev" href="../expression_base_converter/">
      
      
        <link rel="next" href="../../generate_operator/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>ExpressionEvaluator - Opulse</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#opulse.expression.expression_evaluator" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Opulse" class="md-header__button md-logo" aria-label="Opulse" data-md-component="logo">
      
  <img src="../../assets/images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Opulse
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ExpressionEvaluator
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/opulse-exp/op_plus.git" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    Opulse
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Opulse" class="md-nav__button md-logo" aria-label="Opulse" data-md-component="logo">
      
  <img src="../../assets/images/logo.png" alt="logo">

    </a>
    Opulse
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/opulse-exp/op_plus.git" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    Opulse
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcome
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Config
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Config
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config/generate_operator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Operator Config
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config/generate_expression/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Expression Config
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    CoreAPI
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            CoreAPI
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Operatorplus
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Operatorplus
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operatorplus/operator_info/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OperatorInfo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operatorplus/condition_generator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ConditionGenerator
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operatorplus/operator_generator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OperatorGenerator.md
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operatorplus/operator_manager/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OperatorManager.md
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operatorplus/operator_definition_parser/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OperatorDefinitionParser.md
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operatorplus/operator_transformer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OperatorTransformer.md
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operatorplus/compiler/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CythonCompiler
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operatorplus/operator_priority_manager/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OperatorPriorityManager
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operatorplus/operator_dependency_graph/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OperatorDependencyGraph
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Expression
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Expression
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../expression_node/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ExpressionNode
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../expression_generator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ExpressionGenerator
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../base_converter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BaseConverter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../expression_base_converter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ExpressionBaseConverter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    ExpressionEvaluator
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    ExpressionEvaluator
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#opulse.expression.expression_evaluator" class="md-nav__link">
    <span class="md-ellipsis">
      expression_evaluator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#opulse.expression.expression_evaluator.ExpressionEvaluator" class="md-nav__link">
    <span class="md-ellipsis">
      ExpressionEvaluator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ExpressionEvaluator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#opulse.expression.expression_evaluator.ExpressionEvaluator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opulse.expression.expression_evaluator.ExpressionEvaluator.calculate_complexity_ratio" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_complexity_ratio
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opulse.expression.expression_evaluator.ExpressionEvaluator.calculate_highest_n_order" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_highest_n_order
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opulse.expression.expression_evaluator.ExpressionEvaluator.calculate_normalized_expansion_degree" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_normalized_expansion_degree
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opulse.expression.expression_evaluator.ExpressionEvaluator.calculate_normalized_expansion_degree_node" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_normalized_expansion_degree_node
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opulse.expression.expression_evaluator.ExpressionEvaluator.calculate_operation_count" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_operation_count
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opulse.expression.expression_evaluator.ExpressionEvaluator.calculate_priority_hierarchical_complexity" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_priority_hierarchical_complexity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opulse.expression.expression_evaluator.ExpressionEvaluator.calculate_result" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_result
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opulse.expression.expression_evaluator.ExpressionEvaluator.evaluate" class="md-nav__link">
    <span class="md-ellipsis">
      evaluate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opulse.expression.expression_evaluator.ExpressionEvaluator.init_expr" class="md-nav__link">
    <span class="md-ellipsis">
      init_expr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opulse.expression.expression_evaluator.ExpressionEvaluator.load_atoms" class="md-nav__link">
    <span class="md-ellipsis">
      load_atoms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opulse.expression.expression_evaluator.ExpressionEvaluator.set_with_all_brackets" class="md-nav__link">
    <span class="md-ellipsis">
      set_with_all_brackets
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opulse.expression.expression_evaluator.ExpressionEvaluator.tree_to_str" class="md-nav__link">
    <span class="md-ellipsis">
      tree_to_str
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Generate
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Generate
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../generate_operator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Operator Generate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../generate_expression/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Expression Generate
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#opulse.expression.expression_evaluator" class="md-nav__link">
    <span class="md-ellipsis">
      expression_evaluator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#opulse.expression.expression_evaluator.ExpressionEvaluator" class="md-nav__link">
    <span class="md-ellipsis">
      ExpressionEvaluator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ExpressionEvaluator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#opulse.expression.expression_evaluator.ExpressionEvaluator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opulse.expression.expression_evaluator.ExpressionEvaluator.calculate_complexity_ratio" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_complexity_ratio
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opulse.expression.expression_evaluator.ExpressionEvaluator.calculate_highest_n_order" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_highest_n_order
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opulse.expression.expression_evaluator.ExpressionEvaluator.calculate_normalized_expansion_degree" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_normalized_expansion_degree
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opulse.expression.expression_evaluator.ExpressionEvaluator.calculate_normalized_expansion_degree_node" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_normalized_expansion_degree_node
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opulse.expression.expression_evaluator.ExpressionEvaluator.calculate_operation_count" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_operation_count
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opulse.expression.expression_evaluator.ExpressionEvaluator.calculate_priority_hierarchical_complexity" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_priority_hierarchical_complexity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opulse.expression.expression_evaluator.ExpressionEvaluator.calculate_result" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_result
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opulse.expression.expression_evaluator.ExpressionEvaluator.evaluate" class="md-nav__link">
    <span class="md-ellipsis">
      evaluate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opulse.expression.expression_evaluator.ExpressionEvaluator.init_expr" class="md-nav__link">
    <span class="md-ellipsis">
      init_expr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opulse.expression.expression_evaluator.ExpressionEvaluator.load_atoms" class="md-nav__link">
    <span class="md-ellipsis">
      load_atoms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opulse.expression.expression_evaluator.ExpressionEvaluator.set_with_all_brackets" class="md-nav__link">
    <span class="md-ellipsis">
      set_with_all_brackets
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opulse.expression.expression_evaluator.ExpressionEvaluator.tree_to_str" class="md-nav__link">
    <span class="md-ellipsis">
      tree_to_str
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>ExpressionEvaluator</h1>

<div class="doc doc-object doc-module">



<a id="opulse.expression.expression_evaluator"></a>
    <div class="doc doc-contents first">








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="opulse.expression.expression_evaluator.ExpressionEvaluator" class="doc doc-heading">
            <code>ExpressionEvaluator</code>


</h2>


    <div class="doc doc-contents ">







              <details class="quote">
                <summary>Source code in <code>opulse/expression/expression_evaluator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ExpressionEvaluator</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">param_config</span><span class="p">:</span> <span class="n">ParamConfig</span><span class="p">,</span>
        <span class="n">logger</span><span class="p">:</span> <span class="n">LogConfig</span><span class="p">,</span>
        <span class="n">cython_cache_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">operator_manager</span><span class="p">:</span> <span class="n">OperatorManager</span><span class="p">,</span>
        <span class="n">base_converter</span><span class="p">:</span> <span class="n">BaseConverter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes an instance of the ExpressionEvaluator class.</span>

<span class="sd">        This constructor sets up the expression evaluator with necessary configurations and managers.</span>
<span class="sd">        It initializes attributes to manage expression trees, operators, logging, and base conversions.</span>
<span class="sd">        Additionally, it prepares data structures to track operator priorities, operation counts, and highest n-order values.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            param_config (ParamConfig): Configuration settings for controlling the behavior of the expression evaluator.</span>
<span class="sd">            logger (LogConfig): Configuration for setting up logging. Used to create a logger instance for this evaluator.</span>
<span class="sd">            operator_manager (OperatorManager): Manager object that provides information about operators used in expressions.</span>
<span class="sd">            base_converter (BaseConverter, optional): Converter object for handling different numerical bases in expressions. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_config</span> <span class="o">=</span> <span class="n">param_config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span>
        <span class="c1"># Initialization of relevant expressions to None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expression_tree</span><span class="p">:</span> <span class="n">ExpressionNode</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expression_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operator_manager</span> <span class="o">=</span> <span class="n">operator_manager</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_converter</span> <span class="o">=</span> <span class="n">base_converter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_priority</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operation_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">highest_n_order</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Record all operators key: op id, value: number of occurrences</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_operators</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">with_all_brackets</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cython_cache_dir</span> <span class="o">=</span> <span class="n">cython_cache_dir</span>
        <span class="c1"># Used to replace meta words in expression strings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_atoms</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set_with_all_brackets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">with_all_brackets</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets whether to include all brackets in the expression string.</span>

<span class="sd">        This method configures the behavior for generating expression strings. If set to True, it ensures that all parts of the</span>
<span class="sd">        expression that require parentheses for correct order of operations will be enclosed in brackets. This can be useful</span>
<span class="sd">        for ensuring clarity or for specific formatting requirements.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            with_all_brackets (bool): A flag indicating whether to include all necessary brackets in the expression string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">with_all_brackets</span> <span class="o">=</span> <span class="n">with_all_brackets</span>

    <span class="k">def</span> <span class="nf">load_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads atomic symbols from the parameter configuration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;left_bracket&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;other_symbols_atoms&quot;</span><span class="p">)[</span>
                <span class="s2">&quot;left_parenthesis&quot;</span>
            <span class="p">],</span>
            <span class="s2">&quot;right_bracket&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;other_symbols_atoms&quot;</span><span class="p">)[</span>
                <span class="s2">&quot;right_parenthesis&quot;</span>
            <span class="p">],</span>
            <span class="s2">&quot;NaN&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;other_symbols_atoms&quot;</span><span class="p">)[</span><span class="s2">&quot;nan_symbol&quot;</span><span class="p">],</span>
            <span class="s2">&quot;equal&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;other_symbols_atoms&quot;</span><span class="p">)[</span><span class="s2">&quot;equals_sign&quot;</span><span class="p">],</span>
            <span class="s2">&quot;Inf&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;other_symbols_atoms&quot;</span><span class="p">)[</span><span class="s2">&quot;inf_symbol&quot;</span><span class="p">],</span>
            <span class="s2">&quot;-Inf&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;other_symbols_atoms&quot;</span><span class="p">)[</span><span class="s2">&quot;neg_inf_symbol&quot;</span><span class="p">],</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">init_expr</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">expression_tree</span><span class="p">,</span>
        <span class="nb">id</span><span class="p">,</span>
        <span class="n">op_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">expr_result_base</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">longer_result_info</span><span class="p">:</span> <span class="n">LongerResultInfo</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes expression attributes with an expression tree and ID.</span>

<span class="sd">        This method sets up the initial state for an expression by assigning an identifier and an expression tree.</span>
<span class="sd">        It also initializes counters and dictionaries that will be used to track various properties of the expression,</span>
<span class="sd">        such as operator priorities, operation counts, and operator occurrences. Finally, it generates string representations</span>
<span class="sd">        of the expression based on the provided tree structure and optional parameters.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            expression_tree (ExpressionNode): The root node of the expression tree to initialize.</span>
<span class="sd">            id (any): An identifier for the expression, which can be any type that uniquely identifies the expression.</span>
<span class="sd">            op_mode (bool, optional): A flag indicating whether the expression should be processed in operator mode. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expression_tree</span> <span class="o">=</span> <span class="n">expression_tree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cot_info</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cot</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_priority</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operation_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variable_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">highest_n_order</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expr_result</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normalized_expansion_degree</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_operators</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expr_result_base</span> <span class="o">=</span> <span class="n">expr_result_base</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span> <span class="o">=</span> <span class="n">longer_result_info</span>
        <span class="k">if</span> <span class="n">op_mode</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">expression_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_to_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expression_tree</span><span class="p">,</span> <span class="n">op_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">expression_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_to_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expression_tree</span><span class="p">,</span> <span class="n">statistic_analysis</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">expression_str_no_base_symbol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_to_str</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">expression_tree</span><span class="p">,</span> <span class="n">with_base_symbol</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">op_info_sub_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">NumberNode</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">BinaryExpressionNode</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">op_info_sub_tree</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left_expr</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">op_info_sub_tree</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">right_expr</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">all_operators</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">func_id</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">UnaryExpressionNode</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">op_info_sub_tree</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">unary_expr</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">all_operators</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">func_id</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">VariableNode</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;ExpressionEvaluator.op_info_sub_tree&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">all_op_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_operators</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op_info_sub_tree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expression_tree</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_operators</span>

    <span class="k">def</span> <span class="nf">tree_to_str</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">node</span><span class="p">:</span> <span class="n">ExpressionNode</span><span class="p">,</span>
        <span class="n">parent_op</span><span class="p">:</span> <span class="n">OperatorInfo</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">with_base_symbol</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">op_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">statistic_analysis</span><span class="p">:</span><span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts an expression tree node to a string representation.</span>

<span class="sd">        This method recursively traverses the expression tree and builds a string representation based on the node type.</span>
<span class="sd">        For binary and unary expression nodes, it checks the operator priority relative to the parent node&#39;s operator priority</span>
<span class="sd">        to determine if parentheses are needed to preserve correct order of operations.</span>
<span class="sd">        For number and variable nodes, it returns their direct string representations.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            node (ExpressionNode): The expression node to convert.</span>
<span class="sd">            parent_op (OperatorInfo, optional): Information about the parent operator, used to determine if parentheses are needed. Defaults to None.</span>
<span class="sd">            with_base_symbol (bool, optional): Whether to include base symbols in the string. Defaults to True.</span>
<span class="sd">            op_mode (bool, optional): A flag indicating operator mode. Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: String representation of the expression node.</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: If an unsupported expression node type is encountered.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Requires the priority of the parent node&#39;s operator for determining whether to add brackets</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">NumberNode</span><span class="p">):</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">NumberNode</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">op_mode</span><span class="p">:</span>
                <span class="c1"># when op_mode, we don&#39;t generate any base-related symbol</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">to_str_no_base_symbol</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">statistic_analysis</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">number_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">with_base_symbol</span><span class="p">:</span>
                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">to_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">operator_manager</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">base_converter</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">to_str_no_base_symbol</span><span class="p">(</span><span class="n">surround_symbol</span><span class="o">=</span><span class="s1">&#39;$&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">VariableNode</span><span class="p">):</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">BinaryExpressionNode</span><span class="p">):</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">BinaryExpressionNode</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">op_mode</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">statistic_analysis</span><span class="p">:</span>
                    <span class="c1"># Statistical priority for calculating calculate_priority_hierarchical_complexity</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">priority</span> <span class="o">!=</span> <span class="kc">None</span>
                        <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">priority</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_priority</span>
                    <span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">all_priority</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">priority</span><span class="p">)</span>
                    <span class="c1"># Count the number of operations and associate the expression with the operator</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">operation_count</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">all_operators</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">func_id</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="c1"># Count the n_order info</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">highest_n_order</span> <span class="o">&lt;</span> <span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">n_order</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">highest_n_order</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">n_order</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operation_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">all_operators</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">func_id</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># Convert the expression of the subtree</span>
            <span class="n">left_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_to_str</span><span class="p">(</span>
                <span class="n">node</span><span class="o">.</span><span class="n">left_expr</span><span class="p">,</span>
                <span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="p">,</span>
                <span class="n">with_base_symbol</span><span class="o">=</span><span class="n">with_base_symbol</span><span class="p">,</span>
                <span class="n">op_mode</span><span class="o">=</span><span class="n">op_mode</span><span class="p">,</span>
                <span class="n">statistic_analysis</span><span class="o">=</span><span class="n">statistic_analysis</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">right_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_to_str</span><span class="p">(</span>
                <span class="n">node</span><span class="o">.</span><span class="n">right_expr</span><span class="p">,</span>
                <span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="p">,</span>
                <span class="n">with_base_symbol</span><span class="o">=</span><span class="n">with_base_symbol</span><span class="p">,</span>
                <span class="n">op_mode</span><span class="o">=</span><span class="n">op_mode</span><span class="p">,</span>
                <span class="n">statistic_analysis</span><span class="o">=</span><span class="n">statistic_analysis</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_all_brackets</span><span class="p">:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="s1">&#39;left_bracket&#39;</span><span class="p">]</span><span class="si">}{</span><span class="n">left_str</span><span class="si">}{</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">symbol</span><span class="si">}{</span><span class="n">right_str</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="s1">&#39;right_bracket&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="c1"># self.logger.debug(f&quot;parent_op: {parent_op}&quot;)</span>
            <span class="k">if</span> <span class="n">parent_op</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">priority</span> <span class="o">&lt;</span> <span class="n">parent_op</span><span class="o">.</span><span class="n">priority</span><span class="p">:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="s1">&#39;left_bracket&#39;</span><span class="p">]</span><span class="si">}{</span><span class="n">left_str</span><span class="si">}{</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">symbol</span><span class="si">}{</span><span class="n">right_str</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="s1">&#39;right_bracket&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">parent_op</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">priority</span> <span class="o">==</span> <span class="n">parent_op</span><span class="o">.</span><span class="n">priority</span><span class="p">:</span>
                <span class="c1"># If it has the same priority as parent op, choose whether to add parentheses or not based on location and binding.</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">parent_op</span><span class="o">.</span><span class="n">associativity_direction</span> <span class="o">==</span> <span class="s2">&quot;left&quot;</span>
                    <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="s2">&quot;right&quot;</span>
                <span class="p">):</span>
                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="s1">&#39;left_bracket&#39;</span><span class="p">]</span><span class="si">}{</span><span class="n">left_str</span><span class="si">}{</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">symbol</span><span class="si">}{</span><span class="n">right_str</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="s1">&#39;right_bracket&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">elif</span> <span class="p">(</span>
                    <span class="n">parent_op</span><span class="o">.</span><span class="n">associativity_direction</span> <span class="o">==</span> <span class="s2">&quot;right&quot;</span>
                    <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="s2">&quot;left&quot;</span>
                <span class="p">):</span>
                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="s1">&#39;left_bracket&#39;</span><span class="p">]</span><span class="si">}{</span><span class="n">left_str</span><span class="si">}{</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">symbol</span><span class="si">}{</span><span class="n">right_str</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="s1">&#39;right_bracket&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">left_str</span><span class="si">}{</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">symbol</span><span class="si">}{</span><span class="n">right_str</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">left_str</span><span class="si">}{</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">symbol</span><span class="si">}{</span><span class="n">right_str</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">UnaryExpressionNode</span><span class="p">):</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">UnaryExpressionNode</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">op_mode</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">statistic_analysis</span><span class="p">:</span>
                    <span class="c1"># Statistical priority for calculating calculate_priority_hierarchical_complexity</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">priority</span> <span class="o">!=</span> <span class="kc">None</span>
                        <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">priority</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_priority</span>
                    <span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">all_priority</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">priority</span><span class="p">)</span>
                    <span class="c1"># Count the number of operations and associate the expression with the operator</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">operation_count</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">all_operators</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">func_id</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="c1"># Count the n_order info</span>
                    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">n_order</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">func_id</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">highest_n_order</span> <span class="o">&lt;</span> <span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">n_order</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">highest_n_order</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">n_order</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operation_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">all_operators</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">func_id</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">unary_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_to_str</span><span class="p">(</span>
                <span class="n">node</span><span class="o">.</span><span class="n">unary_expr</span><span class="p">,</span>
                <span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="p">,</span>
                <span class="n">with_base_symbol</span><span class="o">=</span><span class="n">with_base_symbol</span><span class="p">,</span>
                <span class="n">op_mode</span><span class="o">=</span><span class="n">op_mode</span><span class="p">,</span>
                <span class="n">statistic_analysis</span><span class="o">=</span><span class="n">statistic_analysis</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">unary_position</span><span class="o">==</span><span class="s1">&#39;postfix&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">unary_str</span><span class="si">}{</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">symbol</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">unary_position</span><span class="o">==</span><span class="s1">&#39;prefix&#39;</span><span class="p">:</span>
            <span class="c1"># Doubt: Always choose to add brackets to unary</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">symbol</span><span class="si">}{</span><span class="n">unary_str</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;ExpressionEvaluator.tree_to_str&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">calculate_highest_n_order</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the highest n-order of the expression.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (int): The highest n-order value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">highest_n_order</span>

    <span class="k">def</span> <span class="nf">calculate_priority_hierarchical_complexity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the priority-based hierarchical complexity.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (int): The complexity value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_priority</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">calculate_normalized_expansion_degree</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="c1"># Implementing the computational logic for normalized expansion degree</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the normalized expansion degree of the expression.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (int): The normalized expansion degree or &quot;NaN&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">normalized_expansion_degree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalized_expansion_degree</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalized_expansion_degree</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># return (</span>
            <span class="c1">#     self.normalized_expansion_degree</span>
            <span class="c1">#     if self.normalized_expansion_degree != &quot;NaN&quot;</span>
            <span class="c1">#     else self.atoms[&quot;NaN&quot;]</span>
            <span class="c1"># )</span>
            <span class="n">normalized_expansion_degree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalized_expansion_degree</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">degree</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_normalized_expansion_degree_node</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">expression_tree</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">normalized_expansion_degree</span> <span class="o">=</span> <span class="n">degree</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">expr_result</span> <span class="o">=</span> <span class="n">result</span>
            <span class="n">normalized_expansion_degree</span> <span class="o">=</span> <span class="n">degree</span>

        <span class="k">if</span> <span class="n">normalized_expansion_degree</span> <span class="o">!=</span> <span class="n">normalized_expansion_degree</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="s2">&quot;NaN&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">normalized_expansion_degree</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="s2">&quot;Inf&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">normalized_expansion_degree</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="s2">&quot;-Inf&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalized_expansion_degree</span>

    <span class="k">def</span> <span class="nf">calculate_result</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the normalized expansion degree of the expression.</span>

<span class="sd">        The normalized expansion degree is a measure that represents how much an expression has been expanded or simplified.</span>
<span class="sd">        It can be used to evaluate the complexity of the expression in terms of its structure and size after operations.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Union[int, str]): The normalized expansion degree or &quot;NaN&quot;.s an integer or &quot;NaN&quot; if it cannot be calculated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">expr_result</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr_result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">expr_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr_result</span>
            <span class="c1"># return self.expr_result if self.expr_result != &quot;NaN&quot; else self.atoms[&quot;NaN&quot;]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">degree</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_normalized_expansion_degree_node</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">expression_tree</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">normalized_expansion_degree</span> <span class="o">=</span> <span class="n">degree</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">expr_result</span> <span class="o">=</span> <span class="n">result</span>
            <span class="n">expr_result</span> <span class="o">=</span> <span class="n">result</span>
            <span class="c1"># return self.expr_result if self.expr_result != &quot;NaN&quot; else self.atoms[&quot;NaN&quot;]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr_result_base</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">expr_result</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ExpressionBaseConverter</span><span class="o">.</span><span class="n">convert_int_to_targetbase</span><span class="p">(</span>
                <span class="nb">input</span><span class="o">=</span><span class="n">expr_result</span><span class="p">,</span>
                <span class="n">output_base</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">expr_result_base</span><span class="p">,</span>
                <span class="n">base_converter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">base_converter</span><span class="p">,</span>
                <span class="n">operator_manager</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">operator_manager</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">expr_result</span> <span class="o">!=</span> <span class="n">expr_result</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="s2">&quot;NaN&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">expr_result</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="s2">&quot;Inf&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">expr_result</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="s2">&quot;-Inf&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">expr_result</span>

    <span class="k">def</span> <span class="nf">get_compute_count_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator</span><span class="p">:</span><span class="n">OperatorInfo</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">operator</span><span class="o">.</span><span class="n">module</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># for depend_id in operator.dependencies:</span>
            <span class="c1">#     so_file = f&quot;module_{depend_id}.cpython-310-x86_64-linux-gnu.so&quot;</span>
            <span class="c1">#     full_path = os.path.join(self.cython_cache_dir, so_file)</span>
            <span class="c1">#     if os.path.exists(full_path):</span>
            <span class="c1">#         self.operator_manager.compiler.import_module_from_path(f&quot;module_{operator.func_id}&quot;)</span>
            <span class="n">so_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;module_</span><span class="si">{</span><span class="n">operator</span><span class="o">.</span><span class="n">func_id</span><span class="si">}</span><span class="s2">.cpython-310-x86_64-linux-gnu.so&quot;</span>
            <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cython_cache_dir</span><span class="p">,</span> <span class="n">so_file</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">full_path</span><span class="p">):</span>
                <span class="n">operator</span><span class="o">.</span><span class="n">module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">operator_manager</span><span class="o">.</span><span class="n">compiler</span><span class="o">.</span><span class="n">import_module_from_path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;module_</span><span class="si">{</span><span class="n">operator</span><span class="o">.</span><span class="n">func_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">compute_func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;op_</span><span class="si">{</span><span class="n">operator</span><span class="o">.</span><span class="n">func_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">count_func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">module</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;op_count_</span><span class="si">{</span><span class="n">operator</span><span class="o">.</span><span class="n">func_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">compute_func</span><span class="p">,</span> <span class="n">count_func</span>

    <span class="k">def</span> <span class="nf">get_target_base_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">target_base</span><span class="p">:</span><span class="nb">int</span> <span class="p">)</span><span class="o">-&gt;</span><span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">!=</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">value_str_with_base</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value_str_with_base</span><span class="o">=</span><span class="n">ExpressionBaseConverter</span><span class="o">.</span><span class="n">convert_int_to_targetbase</span><span class="p">(</span>
                <span class="nb">input</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">),</span>
                <span class="n">output_base</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span><span class="o">.</span><span class="n">target_base</span><span class="p">,</span>
                <span class="n">base_converter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">base_converter</span><span class="p">,</span>
                <span class="n">operator_manager</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">operator_manager</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">value_str_with_base</span>

    <span class="k">def</span> <span class="nf">calculate_normalized_expansion_degree_node</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ExpressionNode</span><span class="p">,</span> <span class="n">cot_layer</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper method to recursively calculate the normalized expansion degree for each node in the expression tree.</span>

<span class="sd">        This method traverses the expression tree and computes the degree based on the type and structure of nodes.</span>

<span class="sd">        Args:</span>
<span class="sd">            node (ExpressionNode): The current node in the expression tree.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (Tuple[Union[int, str], Union[int, str]]): A tuple containing the normalized expansion degree and the evaluation result of the node.</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: If the node type is not recognized.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># For a single expression tree node, compute the normalized expansion of the tree rooted at this node and the resultant</span>
        <span class="c1"># if isinstance(node, NumberNode):</span>
        <span class="c1">#     return 0, node.value</span>
        <span class="c1"># elif isinstance(node, UnaryExpressionNode):</span>
        <span class="c1">#     sub_degree, sub_result = self.calculate_normalized_expansion_degree_node(</span>
        <span class="c1">#         node.unary_expr</span>
        <span class="c1">#     )</span>
        <span class="c1">#     if sub_degree == &quot;NaN&quot; or sub_result == &quot;NaN&quot;:</span>
        <span class="c1">#         return &quot;NaN&quot;, &quot;NaN&quot;</span>
        <span class="c1">#     cur_result = node.operator.get_compute_function()(sub_result)</span>
        <span class="c1">#     cur_degree = node.operator.get_count_function()(sub_result)</span>
        <span class="c1">#     if cur_degree == &quot;NaN&quot; or cur_result == &quot;NaN&quot;:</span>
        <span class="c1">#         return &quot;NaN&quot;, &quot;NaN&quot;</span>
        <span class="c1">#     return cur_degree + sub_degree, cur_result</span>
        <span class="c1"># elif isinstance(node, BinaryExpressionNode):</span>
        <span class="c1">#     # 二元操作符，分别计算左右子树的归一展开度</span>
        <span class="c1">#     left_degree, left_result = self.calculate_normalized_expansion_degree_node(</span>
        <span class="c1">#         node.left_expr</span>
        <span class="c1">#     )</span>
        <span class="c1">#     if left_degree == &quot;NaN&quot; or left_result == &quot;NaN&quot;:</span>
        <span class="c1">#         return &quot;NaN&quot;, &quot;NaN&quot;</span>
        <span class="c1">#     right_degree, right_result = (</span>
        <span class="c1">#         self.calculate_normalized_expansion_degree_node(node.right_expr)</span>
        <span class="c1">#     )</span>
        <span class="c1">#     if right_degree == &quot;NaN&quot; or right_result == &quot;NaN&quot;:</span>
        <span class="c1">#         return &quot;NaN&quot;, &quot;NaN&quot;</span>
        <span class="c1">#     cur_result = node.operator.get_compute_function()(left_result, right_result)</span>
        <span class="c1">#     cur_degree = node.operator.get_count_function()(left_result, right_result)</span>
        <span class="c1">#     if cur_degree == &quot;NaN&quot; or cur_result == &quot;NaN&quot;:</span>
        <span class="c1">#         return &quot;NaN&quot;, &quot;NaN&quot;</span>
        <span class="c1">#     return cur_degree + left_degree + right_degree, cur_result</span>
        <span class="c1"># elif isinstance(node, VariableNode):</span>
        <span class="c1">#     return &quot;NaN&quot;, &quot;NaN&quot;</span>
        <span class="c1"># else:</span>
        <span class="c1">#     raise NotImplementedError(</span>
        <span class="c1">#         &quot;ExpressionEvaluator.calculate_normalized_expansion_degree_node&quot;</span>
        <span class="c1">#     )</span>

        <span class="n">digits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_converter</span><span class="o">.</span><span class="n">get_digits</span><span class="p">()</span>



        <span class="k">def</span> <span class="nf">check_carry</span><span class="p">(</span><span class="nb">input</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">output</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="n">special_values</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">)]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">NumberNode</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cot_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;info&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;number node, value=</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;layer&quot;</span><span class="p">:</span> <span class="n">cot_layer</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">value</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">UnaryExpressionNode</span><span class="p">):</span>
                <span class="n">sub_degree</span><span class="p">,</span> <span class="n">sub_result</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">calculate_normalized_expansion_degree_node</span><span class="p">(</span>
                        <span class="n">node</span><span class="o">.</span><span class="n">unary_expr</span><span class="p">,</span> <span class="n">cot_layer</span><span class="o">=</span><span class="n">cot_layer</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="c1"># print(f&quot;in compute, {node.operator.id}&quot;)</span>
                <span class="c1"># cur_result = getattr(op_func, f&quot;op_{node.operator.id}&quot;)(sub_result)</span>
                <span class="c1"># cur_degree = getattr(op_func, f&quot;op_count_{node.operator.id}&quot;)(sub_result)</span>

                <span class="c1"># cur_result = node.operator.get_compute_function()(sub_result)</span>
                <span class="c1"># cur_degree = node.operator.get_count_function()(sub_result)</span>
                <span class="n">compute_func</span><span class="p">,</span><span class="n">count_func</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_compute_count_func</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="p">)</span>

                <span class="n">cur_result</span> <span class="o">=</span> <span class="n">compute_func</span><span class="p">(</span><span class="n">sub_result</span><span class="p">)</span>
                <span class="n">cur_degree</span> <span class="o">=</span> <span class="n">count_func</span><span class="p">(</span><span class="n">sub_result</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span><span class="o">.</span><span class="n">flag</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="c1"># if get a longer result by target base, set the flag to True</span>
                    <span class="k">if</span> <span class="n">cur_result</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">cur_result</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">sub_result</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">sub_result</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">cur_result</span> <span class="o">!=</span> <span class="n">cur_result</span> <span class="ow">or</span> <span class="n">sub_result</span> <span class="o">!=</span> <span class="n">sub_result</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># TODO: check this</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">cur_result_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_converter</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span>
                            <span class="n">number</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">cur_result</span><span class="p">),</span> <span class="n">base</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span><span class="o">.</span><span class="n">target_base</span>
                        <span class="p">)</span>
                        <span class="n">sub_result_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_converter</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span>
                            <span class="n">number</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">sub_result</span><span class="p">),</span> <span class="n">base</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span><span class="o">.</span><span class="n">target_base</span>
                        <span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cur_result_str</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">sub_result_str</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">cot_info</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s2">&quot;info&quot;</span><span class="p">:</span><span class="sa">f</span><span class="s2">&quot;compute unary expreesion, input=</span><span class="si">{</span><span class="n">sub_result</span><span class="si">}</span><span class="s2">, op_id = </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">func_id</span><span class="si">}</span><span class="s2">, unary_op_definition = &#39;</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">definition</span><span class="si">}</span><span class="s2">&#39;, output=</span><span class="si">{</span><span class="n">cur_result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;layer&quot;</span><span class="p">:</span><span class="n">cot_layer</span><span class="p">}</span>
                <span class="p">)</span>

                <span class="c1"># prepare for cot</span>
                <span class="n">cur_result_str_with_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_target_base_str</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">cur_result</span><span class="p">,</span><span class="n">target_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span><span class="o">.</span><span class="n">target_base</span><span class="p">)</span>
                <span class="n">sub_result_str_with_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_target_base_str</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">sub_result</span><span class="p">,</span><span class="n">target_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span><span class="o">.</span><span class="n">target_base</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">unary_position</span><span class="o">==</span><span class="s2">&quot;prefix&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cot</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;info&quot;</span><span class="p">:</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">symbol</span><span class="si">}{</span><span class="n">sub_result_str_with_base</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">cur_result_str_with_base</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;layer&quot;</span><span class="p">:</span><span class="n">cot_layer</span><span class="p">})</span>
                <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">unary_position</span><span class="o">==</span><span class="s2">&quot;postfix&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cot</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;info&quot;</span><span class="p">:</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sub_result_str_with_base</span><span class="si">}{</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">symbol</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">cur_result_str_with_base</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;layer&quot;</span><span class="p">:</span><span class="n">cot_layer</span><span class="p">})</span>

                <span class="k">if</span> <span class="n">cur_result</span> <span class="o">!=</span><span class="n">cur_result</span> <span class="ow">or</span> <span class="n">cur_result</span> <span class="ow">in</span> <span class="n">special_values</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cur_result</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cur_result</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">cur_degree</span> <span class="o">+</span> <span class="n">sub_degree</span><span class="p">,</span> <span class="n">cur_result</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">BinaryExpressionNode</span><span class="p">):</span>
                <span class="c1"># 二元操作符，分别计算左右子树的归一展开度</span>
                <span class="n">left_degree</span><span class="p">,</span> <span class="n">left_result</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">calculate_normalized_expansion_degree_node</span><span class="p">(</span>
                        <span class="n">node</span><span class="o">.</span><span class="n">left_expr</span><span class="p">,</span> <span class="n">cot_layer</span><span class="o">=</span><span class="n">cot_layer</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">right_degree</span><span class="p">,</span> <span class="n">right_result</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">calculate_normalized_expansion_degree_node</span><span class="p">(</span>
                        <span class="n">node</span><span class="o">.</span><span class="n">right_expr</span><span class="p">,</span> <span class="n">cot_layer</span><span class="o">=</span><span class="n">cot_layer</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="p">)</span>
                <span class="p">)</span>

                <span class="c1"># print(f&quot;in compute, {node.operator.id}&quot;)</span>
                <span class="c1"># cur_result = getattr(op_func, f&quot;op_{node.operator.id}&quot;)(left_result, right_result)</span>
                <span class="c1"># cur_degree = getattr(op_func, f&quot;op_count_{node.operator.id}&quot;)(left_result, right_result)</span>
                <span class="n">compute_func</span><span class="p">,</span><span class="n">count_func</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_compute_count_func</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="p">)</span>

                <span class="n">cur_result</span> <span class="o">=</span> <span class="n">compute_func</span><span class="p">(</span><span class="n">left_result</span><span class="p">,</span> <span class="n">right_result</span><span class="p">)</span>
                <span class="n">cur_degree</span> <span class="o">=</span> <span class="n">count_func</span><span class="p">(</span><span class="n">left_result</span><span class="p">,</span> <span class="n">right_result</span><span class="p">)</span>
                <span class="c1"># cur_result = node.operator.get_compute_function()(</span>
                <span class="c1">#     left_result, right_result</span>
                <span class="c1"># )</span>
                <span class="c1"># cur_degree = node.operator.get_count_function()(</span>
                <span class="c1">#     left_result, right_result</span>
                <span class="c1"># )</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span><span class="o">.</span><span class="n">flag</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">cur_result</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">cur_result</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">left_result</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">left_result</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">right_result</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">right_result</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">cur_result</span> <span class="o">!=</span> <span class="n">cur_result</span> <span class="ow">or</span> <span class="n">left_result</span> <span class="o">!=</span> <span class="n">left_result</span> <span class="ow">or</span> <span class="n">right_result</span> <span class="o">!=</span> <span class="n">right_result</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># if get a longer result by target base, set the flag to True</span>
                        <span class="n">cur_result_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_converter</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span>
                            <span class="n">number</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">cur_result</span><span class="p">),</span> <span class="n">base</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span><span class="o">.</span><span class="n">target_base</span>
                        <span class="p">)</span>
                        <span class="n">left_result_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_converter</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span>
                            <span class="n">number</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">left_result</span><span class="p">),</span> <span class="n">base</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span><span class="o">.</span><span class="n">target_base</span>
                        <span class="p">)</span>
                        <span class="n">right_result_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_converter</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span>
                            <span class="n">number</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">right_result</span><span class="p">),</span> <span class="n">base</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span><span class="o">.</span><span class="n">target_base</span>
                        <span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cur_result_str</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">left_result_str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span>
                            <span class="n">cur_result_str</span>
                        <span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">right_result_str</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">cot_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;info&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;compute binary expreesion, left_input=</span><span class="si">{</span><span class="n">left_result</span><span class="si">}</span><span class="s2">, right_input=</span><span class="si">{</span><span class="n">right_result</span><span class="si">}</span><span class="s2">, op_id = </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">func_id</span><span class="si">}</span><span class="s2"> binary_op_definition= &#39;</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">definition</span><span class="si">}</span><span class="s2">&#39;, output=</span><span class="si">{</span><span class="n">cur_result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;layer&quot;</span><span class="p">:</span> <span class="n">cot_layer</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">)</span>
                <span class="c1"># prepare for cot</span>
                <span class="n">left_result_str_with_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_target_base_str</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">left_result</span><span class="p">,</span><span class="n">target_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span><span class="o">.</span><span class="n">target_base</span><span class="p">)</span>
                <span class="n">right_result_str_with_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_target_base_str</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">right_result</span><span class="p">,</span><span class="n">target_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span><span class="o">.</span><span class="n">target_base</span><span class="p">)</span>
                <span class="n">cur_result_str_with_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_target_base_str</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">cur_result</span><span class="p">,</span><span class="n">target_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span><span class="o">.</span><span class="n">target_base</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">cot</span><span class="o">.</span><span class="n">append</span><span class="p">({</span> <span class="s2">&quot;info&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">left_result_str_with_base</span><span class="si">}{</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">symbol</span><span class="si">}{</span><span class="n">right_result_str_with_base</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">cur_result_str_with_base</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;layer&quot;</span><span class="p">:</span> <span class="n">cot_layer</span><span class="p">,})</span>

                <span class="k">if</span> <span class="n">cur_result</span> <span class="o">!=</span><span class="n">cur_result</span> <span class="ow">or</span> <span class="n">cur_result</span> <span class="ow">in</span> <span class="n">special_values</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cur_result</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cur_result</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">cur_degree</span> <span class="o">+</span> <span class="n">left_degree</span> <span class="o">+</span> <span class="n">right_degree</span><span class="p">,</span> <span class="n">cur_result</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">VariableNode</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                    <span class="s2">&quot;ExpressionEvaluator.calculate_normalized_expansion_degree_node&quot;</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># print(f&quot;node: {node.operator.id}&quot;)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">BinaryExpressionNode</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in ExpressionEvaluator.tree_to_str: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">,cur_result=</span><span class="si">{</span><span class="n">cur_result</span><span class="si">}</span><span class="s2">,left_result=</span><span class="si">{</span><span class="n">left_result</span><span class="si">}</span><span class="s2">,right_result=</span><span class="si">{</span><span class="n">right_result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="n">UnaryExpressionNode</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in ExpressionEvaluator.tree_to_str: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">,cur_result=</span><span class="si">{</span><span class="n">cur_result</span><span class="si">}</span><span class="s2">,sub_result=</span><span class="si">{</span><span class="n">sub_result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in ExpressionEvaluator.tree_to_str: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>

    <span class="k">def</span> <span class="nf">calculate_operation_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the total number of operations in the expression.</span>

<span class="sd">        This method returns the count of all operations that were encountered during the construction of the expression tree.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (int): The operation count as an integer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">operation_count</span>

    <span class="k">def</span> <span class="nf">all_dependent_operators</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">List</span><span class="p">:</span>
        <span class="n">used_ops_func_id</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_operators</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">dependent_ops</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">op_func_id</span> <span class="ow">in</span> <span class="n">used_ops_func_id</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">operator_manager</span><span class="o">.</span><span class="n">get_operator_by_func_id</span><span class="p">(</span><span class="n">op_func_id</span><span class="o">=</span><span class="n">op_func_id</span><span class="p">)</span><span class="o">.</span><span class="n">dependencies</span><span class="o">!=</span><span class="kc">None</span><span class="p">:</span>
                <span class="n">dependent_ops</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">operator_manager</span><span class="o">.</span><span class="n">get_operator_by_func_id</span><span class="p">(</span><span class="n">op_func_id</span><span class="o">=</span><span class="n">op_func_id</span><span class="p">)</span><span class="o">.</span><span class="n">dependencies</span>
        <span class="k">return</span> <span class="n">dependent_ops</span>

    <span class="k">def</span> <span class="nf">number_count</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_count</span>

    <span class="k">def</span> <span class="nf">calculate_complexity_ratio</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the complexity ratio based on normalized expansion degree and operation count.</span>

<span class="sd">        The complexity ratio provides a measure of how complex the expression is relative to the number of operations it contains.</span>
<span class="sd">        It is calculated by dividing the normalized expansion degree by the operation count.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (int): The complexity ratio as a floating-point number. Returns 0 if the operation count is 0 or the expansion degree is &quot;NaN&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">operation_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_operation_count</span><span class="p">()</span>
        <span class="n">normalized_expansion_degree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_normalized_expansion_degree</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">normalized_expansion_degree</span> <span class="o">/</span> <span class="n">operation_count</span>
            <span class="k">if</span> <span class="n">operation_count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">normalized_expansion_degree</span> <span class="o">!=</span> <span class="s2">&quot;NaN&quot;</span>
            <span class="k">else</span> <span class="mi">0</span>
        <span class="p">)</span>

    <span class="c1"># def calculate_max_digit_count(self):</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     Calculates the maximum digit count in the expression string.</span>

    <span class="c1">#     This method extracts all numbers from the expression string, converts them to integers, and determines the length of the largest number.</span>

    <span class="c1">#     Returns:</span>
    <span class="c1">#         (int): The maximum digit count as an integer. Returns 0 if there are no digits in the expression string.</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     numbers = [int(num) for num in self.expression_str.split() if num.isdigit()]</span>
    <span class="c1">#     return max((len(str(num)) for num in numbers), default=0)</span>
    <span class="k">def</span> <span class="nf">get_base</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;random_base&quot;</span><span class="p">)[</span><span class="s2">&quot;flag&quot;</span><span class="p">]</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;random_base&quot;</span><span class="p">)[</span><span class="s2">&quot;base&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluates the expression and returns its properties.</span>

<span class="sd">        This method aggregates various metrics about the expression, such as its highest n-order, hierarchical complexity,</span>
<span class="sd">        normalized expansion degree, operation count, complexity ratio, maximum digit count, and result.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (dict): A dictionary containing various properties of the evaluated expression.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s2">&quot;expression_no_base_symbol&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">expression_str_no_base_symbol</span><span class="p">,</span>
            <span class="s2">&quot;expression&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">expression_str</span><span class="p">,</span>
            <span class="s2">&quot;highest_n_order&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_highest_n_order</span><span class="p">(),</span>
            <span class="s2">&quot;priority_hierarchical_complexity&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_priority_hierarchical_complexity</span><span class="p">(),</span>
            <span class="s2">&quot;normalized_expansion_degree&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_normalized_expansion_degree</span><span class="p">(),</span>
            <span class="s2">&quot;operation_count&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_operation_count</span><span class="p">(),</span>
            <span class="s2">&quot;complexity_ratio&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_complexity_ratio</span><span class="p">(),</span>
            <span class="c1"># &quot;max_digit_count&quot;: self.calculate_max_digit_count(),</span>
            <span class="s2">&quot;tree&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">expression_tree</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
            <span class="s2">&quot;used_operators&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_operators</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
            <span class="s2">&quot;dependent_operators&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_dependent_operators</span><span class="p">(),</span>
            <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_result</span><span class="p">(),</span>
            <span class="s2">&quot;longer_result_info&quot;</span><span class="p">:</span> <span class="n">asdict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span><span class="p">),</span>
            <span class="s2">&quot;cot_info&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cot_info</span><span class="p">,</span>
            <span class="s2">&quot;base&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_base</span><span class="p">(),</span>
            <span class="s2">&quot;result_base&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr_result_base</span><span class="p">,</span>
            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">expression_str</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">calculate_result</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;cot&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cot</span><span class="p">,</span>
        <span class="p">}</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="opulse.expression.expression_evaluator.ExpressionEvaluator.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">param_config</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">cython_cache_dir</span><span class="p">,</span> <span class="n">operator_manager</span><span class="p">,</span> <span class="n">base_converter</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initializes an instance of the ExpressionEvaluator class.</p>
<p>This constructor sets up the expression evaluator with necessary configurations and managers.
It initializes attributes to manage expression trees, operators, logging, and base conversions.
Additionally, it prepares data structures to track operator priorities, operation counts, and highest n-order values.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>param_config</code>
            </td>
            <td>
                  <code><span title="config.ParamConfig">ParamConfig</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration settings for controlling the behavior of the expression evaluator.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logger</code>
            </td>
            <td>
                  <code><span title="config.LogConfig">LogConfig</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration for setting up logging. Used to create a logger instance for this evaluator.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>operator_manager</code>
            </td>
            <td>
                  <code><span title="operatorplus.operator_manager.OperatorManager">OperatorManager</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Manager object that provides information about operators used in expressions.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>base_converter</code>
            </td>
            <td>
                  <code><span title="expression.base_converter.BaseConverter">BaseConverter</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Converter object for handling different numerical bases in expressions. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>opulse/expression/expression_evaluator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">param_config</span><span class="p">:</span> <span class="n">ParamConfig</span><span class="p">,</span>
    <span class="n">logger</span><span class="p">:</span> <span class="n">LogConfig</span><span class="p">,</span>
    <span class="n">cython_cache_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">operator_manager</span><span class="p">:</span> <span class="n">OperatorManager</span><span class="p">,</span>
    <span class="n">base_converter</span><span class="p">:</span> <span class="n">BaseConverter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initializes an instance of the ExpressionEvaluator class.</span>

<span class="sd">    This constructor sets up the expression evaluator with necessary configurations and managers.</span>
<span class="sd">    It initializes attributes to manage expression trees, operators, logging, and base conversions.</span>
<span class="sd">    Additionally, it prepares data structures to track operator priorities, operation counts, and highest n-order values.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        param_config (ParamConfig): Configuration settings for controlling the behavior of the expression evaluator.</span>
<span class="sd">        logger (LogConfig): Configuration for setting up logging. Used to create a logger instance for this evaluator.</span>
<span class="sd">        operator_manager (OperatorManager): Manager object that provides information about operators used in expressions.</span>
<span class="sd">        base_converter (BaseConverter, optional): Converter object for handling different numerical bases in expressions. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">param_config</span> <span class="o">=</span> <span class="n">param_config</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span>
    <span class="c1"># Initialization of relevant expressions to None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">expression_tree</span><span class="p">:</span> <span class="n">ExpressionNode</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">expression_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">operator_manager</span> <span class="o">=</span> <span class="n">operator_manager</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">base_converter</span> <span class="o">=</span> <span class="n">base_converter</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">all_priority</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">operation_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">highest_n_order</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># Record all operators key: op id, value: number of occurrences</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">all_operators</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">with_all_brackets</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cython_cache_dir</span> <span class="o">=</span> <span class="n">cython_cache_dir</span>
    <span class="c1"># Used to replace meta words in expression strings</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">load_atoms</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="opulse.expression.expression_evaluator.ExpressionEvaluator.calculate_complexity_ratio" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_complexity_ratio</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculates the complexity ratio based on normalized expansion degree and operation count.</p>
<p>The complexity ratio provides a measure of how complex the expression is relative to the number of operations it contains.
It is calculated by dividing the normalized expansion degree by the operation count.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The complexity ratio as a floating-point number. Returns 0 if the operation count is 0 or the expansion degree is "NaN".</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>opulse/expression/expression_evaluator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_complexity_ratio</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the complexity ratio based on normalized expansion degree and operation count.</span>

<span class="sd">    The complexity ratio provides a measure of how complex the expression is relative to the number of operations it contains.</span>
<span class="sd">    It is calculated by dividing the normalized expansion degree by the operation count.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (int): The complexity ratio as a floating-point number. Returns 0 if the operation count is 0 or the expansion degree is &quot;NaN&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">operation_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_operation_count</span><span class="p">()</span>
    <span class="n">normalized_expansion_degree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_normalized_expansion_degree</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">normalized_expansion_degree</span> <span class="o">/</span> <span class="n">operation_count</span>
        <span class="k">if</span> <span class="n">operation_count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">normalized_expansion_degree</span> <span class="o">!=</span> <span class="s2">&quot;NaN&quot;</span>
        <span class="k">else</span> <span class="mi">0</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="opulse.expression.expression_evaluator.ExpressionEvaluator.calculate_highest_n_order" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_highest_n_order</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculates the highest n-order of the expression.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The highest n-order value.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>opulse/expression/expression_evaluator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_highest_n_order</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the highest n-order of the expression.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (int): The highest n-order value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">highest_n_order</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="opulse.expression.expression_evaluator.ExpressionEvaluator.calculate_normalized_expansion_degree" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_normalized_expansion_degree</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculates the normalized expansion degree of the expression.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The normalized expansion degree or "NaN".</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>opulse/expression/expression_evaluator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_normalized_expansion_degree</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
    <span class="c1"># Implementing the computational logic for normalized expansion degree</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the normalized expansion degree of the expression.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (int): The normalized expansion degree or &quot;NaN&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">normalized_expansion_degree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalized_expansion_degree</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalized_expansion_degree</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># return (</span>
        <span class="c1">#     self.normalized_expansion_degree</span>
        <span class="c1">#     if self.normalized_expansion_degree != &quot;NaN&quot;</span>
        <span class="c1">#     else self.atoms[&quot;NaN&quot;]</span>
        <span class="c1"># )</span>
        <span class="n">normalized_expansion_degree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalized_expansion_degree</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">degree</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_normalized_expansion_degree_node</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">expression_tree</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normalized_expansion_degree</span> <span class="o">=</span> <span class="n">degree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expr_result</span> <span class="o">=</span> <span class="n">result</span>
        <span class="n">normalized_expansion_degree</span> <span class="o">=</span> <span class="n">degree</span>

    <span class="k">if</span> <span class="n">normalized_expansion_degree</span> <span class="o">!=</span> <span class="n">normalized_expansion_degree</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="s2">&quot;NaN&quot;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">normalized_expansion_degree</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="s2">&quot;Inf&quot;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">normalized_expansion_degree</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="s2">&quot;-Inf&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalized_expansion_degree</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="opulse.expression.expression_evaluator.ExpressionEvaluator.calculate_normalized_expansion_degree_node" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_normalized_expansion_degree_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">cot_layer</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Helper method to recursively calculate the normalized expansion degree for each node in the expression tree.</p>
<p>This method traverses the expression tree and computes the degree based on the type and structure of nodes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>node</code>
            </td>
            <td>
                  <code><span title="expression.expression_node.ExpressionNode">ExpressionNode</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current node in the expression tree.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="typing.Union">Union</span>[int, str], <span title="typing.Union">Union</span>[int, str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing the normalized expansion degree and the evaluation result of the node.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>NotImplementedError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the node type is not recognized.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>opulse/expression/expression_evaluator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_normalized_expansion_degree_node</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ExpressionNode</span><span class="p">,</span> <span class="n">cot_layer</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper method to recursively calculate the normalized expansion degree for each node in the expression tree.</span>

<span class="sd">    This method traverses the expression tree and computes the degree based on the type and structure of nodes.</span>

<span class="sd">    Args:</span>
<span class="sd">        node (ExpressionNode): The current node in the expression tree.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (Tuple[Union[int, str], Union[int, str]]): A tuple containing the normalized expansion degree and the evaluation result of the node.</span>

<span class="sd">    Raises:</span>
<span class="sd">        NotImplementedError: If the node type is not recognized.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># For a single expression tree node, compute the normalized expansion of the tree rooted at this node and the resultant</span>
    <span class="c1"># if isinstance(node, NumberNode):</span>
    <span class="c1">#     return 0, node.value</span>
    <span class="c1"># elif isinstance(node, UnaryExpressionNode):</span>
    <span class="c1">#     sub_degree, sub_result = self.calculate_normalized_expansion_degree_node(</span>
    <span class="c1">#         node.unary_expr</span>
    <span class="c1">#     )</span>
    <span class="c1">#     if sub_degree == &quot;NaN&quot; or sub_result == &quot;NaN&quot;:</span>
    <span class="c1">#         return &quot;NaN&quot;, &quot;NaN&quot;</span>
    <span class="c1">#     cur_result = node.operator.get_compute_function()(sub_result)</span>
    <span class="c1">#     cur_degree = node.operator.get_count_function()(sub_result)</span>
    <span class="c1">#     if cur_degree == &quot;NaN&quot; or cur_result == &quot;NaN&quot;:</span>
    <span class="c1">#         return &quot;NaN&quot;, &quot;NaN&quot;</span>
    <span class="c1">#     return cur_degree + sub_degree, cur_result</span>
    <span class="c1"># elif isinstance(node, BinaryExpressionNode):</span>
    <span class="c1">#     # 二元操作符，分别计算左右子树的归一展开度</span>
    <span class="c1">#     left_degree, left_result = self.calculate_normalized_expansion_degree_node(</span>
    <span class="c1">#         node.left_expr</span>
    <span class="c1">#     )</span>
    <span class="c1">#     if left_degree == &quot;NaN&quot; or left_result == &quot;NaN&quot;:</span>
    <span class="c1">#         return &quot;NaN&quot;, &quot;NaN&quot;</span>
    <span class="c1">#     right_degree, right_result = (</span>
    <span class="c1">#         self.calculate_normalized_expansion_degree_node(node.right_expr)</span>
    <span class="c1">#     )</span>
    <span class="c1">#     if right_degree == &quot;NaN&quot; or right_result == &quot;NaN&quot;:</span>
    <span class="c1">#         return &quot;NaN&quot;, &quot;NaN&quot;</span>
    <span class="c1">#     cur_result = node.operator.get_compute_function()(left_result, right_result)</span>
    <span class="c1">#     cur_degree = node.operator.get_count_function()(left_result, right_result)</span>
    <span class="c1">#     if cur_degree == &quot;NaN&quot; or cur_result == &quot;NaN&quot;:</span>
    <span class="c1">#         return &quot;NaN&quot;, &quot;NaN&quot;</span>
    <span class="c1">#     return cur_degree + left_degree + right_degree, cur_result</span>
    <span class="c1"># elif isinstance(node, VariableNode):</span>
    <span class="c1">#     return &quot;NaN&quot;, &quot;NaN&quot;</span>
    <span class="c1"># else:</span>
    <span class="c1">#     raise NotImplementedError(</span>
    <span class="c1">#         &quot;ExpressionEvaluator.calculate_normalized_expansion_degree_node&quot;</span>
    <span class="c1">#     )</span>

    <span class="n">digits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_converter</span><span class="o">.</span><span class="n">get_digits</span><span class="p">()</span>



    <span class="k">def</span> <span class="nf">check_carry</span><span class="p">(</span><span class="nb">input</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">output</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="n">special_values</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">)]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">NumberNode</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cot_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;info&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;number node, value=</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;layer&quot;</span><span class="p">:</span> <span class="n">cot_layer</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">value</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">UnaryExpressionNode</span><span class="p">):</span>
            <span class="n">sub_degree</span><span class="p">,</span> <span class="n">sub_result</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">calculate_normalized_expansion_degree_node</span><span class="p">(</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">unary_expr</span><span class="p">,</span> <span class="n">cot_layer</span><span class="o">=</span><span class="n">cot_layer</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="c1"># print(f&quot;in compute, {node.operator.id}&quot;)</span>
            <span class="c1"># cur_result = getattr(op_func, f&quot;op_{node.operator.id}&quot;)(sub_result)</span>
            <span class="c1"># cur_degree = getattr(op_func, f&quot;op_count_{node.operator.id}&quot;)(sub_result)</span>

            <span class="c1"># cur_result = node.operator.get_compute_function()(sub_result)</span>
            <span class="c1"># cur_degree = node.operator.get_count_function()(sub_result)</span>
            <span class="n">compute_func</span><span class="p">,</span><span class="n">count_func</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_compute_count_func</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="p">)</span>

            <span class="n">cur_result</span> <span class="o">=</span> <span class="n">compute_func</span><span class="p">(</span><span class="n">sub_result</span><span class="p">)</span>
            <span class="n">cur_degree</span> <span class="o">=</span> <span class="n">count_func</span><span class="p">(</span><span class="n">sub_result</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span><span class="o">.</span><span class="n">flag</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="c1"># if get a longer result by target base, set the flag to True</span>
                <span class="k">if</span> <span class="n">cur_result</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">cur_result</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">sub_result</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">sub_result</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">cur_result</span> <span class="o">!=</span> <span class="n">cur_result</span> <span class="ow">or</span> <span class="n">sub_result</span> <span class="o">!=</span> <span class="n">sub_result</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># TODO: check this</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cur_result_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_converter</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span>
                        <span class="n">number</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">cur_result</span><span class="p">),</span> <span class="n">base</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span><span class="o">.</span><span class="n">target_base</span>
                    <span class="p">)</span>
                    <span class="n">sub_result_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_converter</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span>
                        <span class="n">number</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">sub_result</span><span class="p">),</span> <span class="n">base</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span><span class="o">.</span><span class="n">target_base</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cur_result_str</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">sub_result_str</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">cot_info</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;info&quot;</span><span class="p">:</span><span class="sa">f</span><span class="s2">&quot;compute unary expreesion, input=</span><span class="si">{</span><span class="n">sub_result</span><span class="si">}</span><span class="s2">, op_id = </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">func_id</span><span class="si">}</span><span class="s2">, unary_op_definition = &#39;</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">definition</span><span class="si">}</span><span class="s2">&#39;, output=</span><span class="si">{</span><span class="n">cur_result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;layer&quot;</span><span class="p">:</span><span class="n">cot_layer</span><span class="p">}</span>
            <span class="p">)</span>

            <span class="c1"># prepare for cot</span>
            <span class="n">cur_result_str_with_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_target_base_str</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">cur_result</span><span class="p">,</span><span class="n">target_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span><span class="o">.</span><span class="n">target_base</span><span class="p">)</span>
            <span class="n">sub_result_str_with_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_target_base_str</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">sub_result</span><span class="p">,</span><span class="n">target_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span><span class="o">.</span><span class="n">target_base</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">unary_position</span><span class="o">==</span><span class="s2">&quot;prefix&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cot</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;info&quot;</span><span class="p">:</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">symbol</span><span class="si">}{</span><span class="n">sub_result_str_with_base</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">cur_result_str_with_base</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;layer&quot;</span><span class="p">:</span><span class="n">cot_layer</span><span class="p">})</span>
            <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">unary_position</span><span class="o">==</span><span class="s2">&quot;postfix&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cot</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;info&quot;</span><span class="p">:</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sub_result_str_with_base</span><span class="si">}{</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">symbol</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">cur_result_str_with_base</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;layer&quot;</span><span class="p">:</span><span class="n">cot_layer</span><span class="p">})</span>

            <span class="k">if</span> <span class="n">cur_result</span> <span class="o">!=</span><span class="n">cur_result</span> <span class="ow">or</span> <span class="n">cur_result</span> <span class="ow">in</span> <span class="n">special_values</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cur_result</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cur_result</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">cur_degree</span> <span class="o">+</span> <span class="n">sub_degree</span><span class="p">,</span> <span class="n">cur_result</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">BinaryExpressionNode</span><span class="p">):</span>
            <span class="c1"># 二元操作符，分别计算左右子树的归一展开度</span>
            <span class="n">left_degree</span><span class="p">,</span> <span class="n">left_result</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">calculate_normalized_expansion_degree_node</span><span class="p">(</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">left_expr</span><span class="p">,</span> <span class="n">cot_layer</span><span class="o">=</span><span class="n">cot_layer</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">right_degree</span><span class="p">,</span> <span class="n">right_result</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">calculate_normalized_expansion_degree_node</span><span class="p">(</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">right_expr</span><span class="p">,</span> <span class="n">cot_layer</span><span class="o">=</span><span class="n">cot_layer</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># print(f&quot;in compute, {node.operator.id}&quot;)</span>
            <span class="c1"># cur_result = getattr(op_func, f&quot;op_{node.operator.id}&quot;)(left_result, right_result)</span>
            <span class="c1"># cur_degree = getattr(op_func, f&quot;op_count_{node.operator.id}&quot;)(left_result, right_result)</span>
            <span class="n">compute_func</span><span class="p">,</span><span class="n">count_func</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_compute_count_func</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="p">)</span>

            <span class="n">cur_result</span> <span class="o">=</span> <span class="n">compute_func</span><span class="p">(</span><span class="n">left_result</span><span class="p">,</span> <span class="n">right_result</span><span class="p">)</span>
            <span class="n">cur_degree</span> <span class="o">=</span> <span class="n">count_func</span><span class="p">(</span><span class="n">left_result</span><span class="p">,</span> <span class="n">right_result</span><span class="p">)</span>
            <span class="c1"># cur_result = node.operator.get_compute_function()(</span>
            <span class="c1">#     left_result, right_result</span>
            <span class="c1"># )</span>
            <span class="c1"># cur_degree = node.operator.get_count_function()(</span>
            <span class="c1">#     left_result, right_result</span>
            <span class="c1"># )</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span><span class="o">.</span><span class="n">flag</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cur_result</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">cur_result</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">left_result</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">left_result</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">right_result</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">right_result</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">cur_result</span> <span class="o">!=</span> <span class="n">cur_result</span> <span class="ow">or</span> <span class="n">left_result</span> <span class="o">!=</span> <span class="n">left_result</span> <span class="ow">or</span> <span class="n">right_result</span> <span class="o">!=</span> <span class="n">right_result</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                <span class="c1"># if get a longer result by target base, set the flag to True</span>
                    <span class="n">cur_result_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_converter</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span>
                        <span class="n">number</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">cur_result</span><span class="p">),</span> <span class="n">base</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span><span class="o">.</span><span class="n">target_base</span>
                    <span class="p">)</span>
                    <span class="n">left_result_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_converter</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span>
                        <span class="n">number</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">left_result</span><span class="p">),</span> <span class="n">base</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span><span class="o">.</span><span class="n">target_base</span>
                    <span class="p">)</span>
                    <span class="n">right_result_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_converter</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span>
                        <span class="n">number</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">right_result</span><span class="p">),</span> <span class="n">base</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span><span class="o">.</span><span class="n">target_base</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cur_result_str</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">left_result_str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span>
                        <span class="n">cur_result_str</span>
                    <span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">right_result_str</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">cot_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;info&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;compute binary expreesion, left_input=</span><span class="si">{</span><span class="n">left_result</span><span class="si">}</span><span class="s2">, right_input=</span><span class="si">{</span><span class="n">right_result</span><span class="si">}</span><span class="s2">, op_id = </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">func_id</span><span class="si">}</span><span class="s2"> binary_op_definition= &#39;</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">definition</span><span class="si">}</span><span class="s2">&#39;, output=</span><span class="si">{</span><span class="n">cur_result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;layer&quot;</span><span class="p">:</span> <span class="n">cot_layer</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>
            <span class="c1"># prepare for cot</span>
            <span class="n">left_result_str_with_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_target_base_str</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">left_result</span><span class="p">,</span><span class="n">target_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span><span class="o">.</span><span class="n">target_base</span><span class="p">)</span>
            <span class="n">right_result_str_with_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_target_base_str</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">right_result</span><span class="p">,</span><span class="n">target_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span><span class="o">.</span><span class="n">target_base</span><span class="p">)</span>
            <span class="n">cur_result_str_with_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_target_base_str</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">cur_result</span><span class="p">,</span><span class="n">target_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span><span class="o">.</span><span class="n">target_base</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">cot</span><span class="o">.</span><span class="n">append</span><span class="p">({</span> <span class="s2">&quot;info&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">left_result_str_with_base</span><span class="si">}{</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">symbol</span><span class="si">}{</span><span class="n">right_result_str_with_base</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">cur_result_str_with_base</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;layer&quot;</span><span class="p">:</span> <span class="n">cot_layer</span><span class="p">,})</span>

            <span class="k">if</span> <span class="n">cur_result</span> <span class="o">!=</span><span class="n">cur_result</span> <span class="ow">or</span> <span class="n">cur_result</span> <span class="ow">in</span> <span class="n">special_values</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cur_result</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cur_result</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">cur_degree</span> <span class="o">+</span> <span class="n">left_degree</span> <span class="o">+</span> <span class="n">right_degree</span><span class="p">,</span> <span class="n">cur_result</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">VariableNode</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s2">&quot;ExpressionEvaluator.calculate_normalized_expansion_degree_node&quot;</span>
            <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># print(f&quot;node: {node.operator.id}&quot;)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">BinaryExpressionNode</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in ExpressionEvaluator.tree_to_str: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">,cur_result=</span><span class="si">{</span><span class="n">cur_result</span><span class="si">}</span><span class="s2">,left_result=</span><span class="si">{</span><span class="n">left_result</span><span class="si">}</span><span class="s2">,right_result=</span><span class="si">{</span><span class="n">right_result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="n">UnaryExpressionNode</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in ExpressionEvaluator.tree_to_str: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">,cur_result=</span><span class="si">{</span><span class="n">cur_result</span><span class="si">}</span><span class="s2">,sub_result=</span><span class="si">{</span><span class="n">sub_result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in ExpressionEvaluator.tree_to_str: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="opulse.expression.expression_evaluator.ExpressionEvaluator.calculate_operation_count" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_operation_count</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculates the total number of operations in the expression.</p>
<p>This method returns the count of all operations that were encountered during the construction of the expression tree.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The operation count as an integer.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>opulse/expression/expression_evaluator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_operation_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the total number of operations in the expression.</span>

<span class="sd">    This method returns the count of all operations that were encountered during the construction of the expression tree.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (int): The operation count as an integer.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">operation_count</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="opulse.expression.expression_evaluator.ExpressionEvaluator.calculate_priority_hierarchical_complexity" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_priority_hierarchical_complexity</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculates the priority-based hierarchical complexity.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The complexity value.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>opulse/expression/expression_evaluator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_priority_hierarchical_complexity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the priority-based hierarchical complexity.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (int): The complexity value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_priority</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="opulse.expression.expression_evaluator.ExpressionEvaluator.calculate_result" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_result</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculates the normalized expansion degree of the expression.</p>
<p>The normalized expansion degree is a measure that represents how much an expression has been expanded or simplified.
It can be used to evaluate the complexity of the expression in terms of its structure and size after operations.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[int, str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The normalized expansion degree or "NaN".s an integer or "NaN" if it cannot be calculated.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>opulse/expression/expression_evaluator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_result</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the normalized expansion degree of the expression.</span>

<span class="sd">    The normalized expansion degree is a measure that represents how much an expression has been expanded or simplified.</span>
<span class="sd">    It can be used to evaluate the complexity of the expression in terms of its structure and size after operations.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (Union[int, str]): The normalized expansion degree or &quot;NaN&quot;.s an integer or &quot;NaN&quot; if it cannot be calculated.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">expr_result</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr_result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">expr_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr_result</span>
        <span class="c1"># return self.expr_result if self.expr_result != &quot;NaN&quot; else self.atoms[&quot;NaN&quot;]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">degree</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_normalized_expansion_degree_node</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">expression_tree</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normalized_expansion_degree</span> <span class="o">=</span> <span class="n">degree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expr_result</span> <span class="o">=</span> <span class="n">result</span>
        <span class="n">expr_result</span> <span class="o">=</span> <span class="n">result</span>
        <span class="c1"># return self.expr_result if self.expr_result != &quot;NaN&quot; else self.atoms[&quot;NaN&quot;]</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr_result_base</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">expr_result</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ExpressionBaseConverter</span><span class="o">.</span><span class="n">convert_int_to_targetbase</span><span class="p">(</span>
            <span class="nb">input</span><span class="o">=</span><span class="n">expr_result</span><span class="p">,</span>
            <span class="n">output_base</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">expr_result_base</span><span class="p">,</span>
            <span class="n">base_converter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">base_converter</span><span class="p">,</span>
            <span class="n">operator_manager</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">operator_manager</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">expr_result</span> <span class="o">!=</span> <span class="n">expr_result</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="s2">&quot;NaN&quot;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">expr_result</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="s2">&quot;Inf&quot;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">expr_result</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="s2">&quot;-Inf&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">expr_result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="opulse.expression.expression_evaluator.ExpressionEvaluator.evaluate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">evaluate</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Evaluates the expression and returns its properties.</p>
<p>This method aggregates various metrics about the expression, such as its highest n-order, hierarchical complexity,
normalized expansion degree, operation count, complexity ratio, maximum digit count, and result.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing various properties of the evaluated expression.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>opulse/expression/expression_evaluator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluates the expression and returns its properties.</span>

<span class="sd">    This method aggregates various metrics about the expression, such as its highest n-order, hierarchical complexity,</span>
<span class="sd">    normalized expansion degree, operation count, complexity ratio, maximum digit count, and result.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (dict): A dictionary containing various properties of the evaluated expression.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="s2">&quot;expression_no_base_symbol&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">expression_str_no_base_symbol</span><span class="p">,</span>
        <span class="s2">&quot;expression&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">expression_str</span><span class="p">,</span>
        <span class="s2">&quot;highest_n_order&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_highest_n_order</span><span class="p">(),</span>
        <span class="s2">&quot;priority_hierarchical_complexity&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_priority_hierarchical_complexity</span><span class="p">(),</span>
        <span class="s2">&quot;normalized_expansion_degree&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_normalized_expansion_degree</span><span class="p">(),</span>
        <span class="s2">&quot;operation_count&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_operation_count</span><span class="p">(),</span>
        <span class="s2">&quot;complexity_ratio&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_complexity_ratio</span><span class="p">(),</span>
        <span class="c1"># &quot;max_digit_count&quot;: self.calculate_max_digit_count(),</span>
        <span class="s2">&quot;tree&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">expression_tree</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
        <span class="s2">&quot;used_operators&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_operators</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
        <span class="s2">&quot;dependent_operators&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_dependent_operators</span><span class="p">(),</span>
        <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_result</span><span class="p">(),</span>
        <span class="s2">&quot;longer_result_info&quot;</span><span class="p">:</span> <span class="n">asdict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span><span class="p">),</span>
        <span class="s2">&quot;cot_info&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cot_info</span><span class="p">,</span>
        <span class="s2">&quot;base&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_base</span><span class="p">(),</span>
        <span class="s2">&quot;result_base&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr_result_base</span><span class="p">,</span>
        <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">expression_str</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">calculate_result</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cot&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cot</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="opulse.expression.expression_evaluator.ExpressionEvaluator.init_expr" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_expr</span><span class="p">(</span><span class="n">expression_tree</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">op_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">expr_result_base</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">longer_result_info</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initializes expression attributes with an expression tree and ID.</p>
<p>This method sets up the initial state for an expression by assigning an identifier and an expression tree.
It also initializes counters and dictionaries that will be used to track various properties of the expression,
such as operator priorities, operation counts, and operator occurrences. Finally, it generates string representations
of the expression based on the provided tree structure and optional parameters.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>expression_tree</code>
            </td>
            <td>
                  <code><span title="expression.expression_node.ExpressionNode">ExpressionNode</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The root node of the expression tree to initialize.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>id</code>
            </td>
            <td>
                  <code>any</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An identifier for the expression, which can be any type that uniquely identifies the expression.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>op_mode</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A flag indicating whether the expression should be processed in operator mode. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>opulse/expression/expression_evaluator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">init_expr</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">expression_tree</span><span class="p">,</span>
    <span class="nb">id</span><span class="p">,</span>
    <span class="n">op_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">expr_result_base</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">longer_result_info</span><span class="p">:</span> <span class="n">LongerResultInfo</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initializes expression attributes with an expression tree and ID.</span>

<span class="sd">    This method sets up the initial state for an expression by assigning an identifier and an expression tree.</span>
<span class="sd">    It also initializes counters and dictionaries that will be used to track various properties of the expression,</span>
<span class="sd">    such as operator priorities, operation counts, and operator occurrences. Finally, it generates string representations</span>
<span class="sd">    of the expression based on the provided tree structure and optional parameters.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        expression_tree (ExpressionNode): The root node of the expression tree to initialize.</span>
<span class="sd">        id (any): An identifier for the expression, which can be any type that uniquely identifies the expression.</span>
<span class="sd">        op_mode (bool, optional): A flag indicating whether the expression should be processed in operator mode. Defaults to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">expression_tree</span> <span class="o">=</span> <span class="n">expression_tree</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cot_info</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cot</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">all_priority</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">operation_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">number_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">variable_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">highest_n_order</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">expr_result</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">normalized_expansion_degree</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">all_operators</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">expr_result_base</span> <span class="o">=</span> <span class="n">expr_result_base</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">longer_result_info</span> <span class="o">=</span> <span class="n">longer_result_info</span>
    <span class="k">if</span> <span class="n">op_mode</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expression_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_to_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expression_tree</span><span class="p">,</span> <span class="n">op_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expression_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_to_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expression_tree</span><span class="p">,</span> <span class="n">statistic_analysis</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expression_str_no_base_symbol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_to_str</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">expression_tree</span><span class="p">,</span> <span class="n">with_base_symbol</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="opulse.expression.expression_evaluator.ExpressionEvaluator.load_atoms" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_atoms</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Loads atomic symbols from the parameter configuration.</p>

            <details class="quote">
              <summary>Source code in <code>opulse/expression/expression_evaluator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Loads atomic symbols from the parameter configuration.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;left_bracket&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;other_symbols_atoms&quot;</span><span class="p">)[</span>
            <span class="s2">&quot;left_parenthesis&quot;</span>
        <span class="p">],</span>
        <span class="s2">&quot;right_bracket&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;other_symbols_atoms&quot;</span><span class="p">)[</span>
            <span class="s2">&quot;right_parenthesis&quot;</span>
        <span class="p">],</span>
        <span class="s2">&quot;NaN&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;other_symbols_atoms&quot;</span><span class="p">)[</span><span class="s2">&quot;nan_symbol&quot;</span><span class="p">],</span>
        <span class="s2">&quot;equal&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;other_symbols_atoms&quot;</span><span class="p">)[</span><span class="s2">&quot;equals_sign&quot;</span><span class="p">],</span>
        <span class="s2">&quot;Inf&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;other_symbols_atoms&quot;</span><span class="p">)[</span><span class="s2">&quot;inf_symbol&quot;</span><span class="p">],</span>
        <span class="s2">&quot;-Inf&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;other_symbols_atoms&quot;</span><span class="p">)[</span><span class="s2">&quot;neg_inf_symbol&quot;</span><span class="p">],</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="opulse.expression.expression_evaluator.ExpressionEvaluator.set_with_all_brackets" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_with_all_brackets</span><span class="p">(</span><span class="n">with_all_brackets</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Sets whether to include all brackets in the expression string.</p>
<p>This method configures the behavior for generating expression strings. If set to True, it ensures that all parts of the
expression that require parentheses for correct order of operations will be enclosed in brackets. This can be useful
for ensuring clarity or for specific formatting requirements.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>with_all_brackets</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A flag indicating whether to include all necessary brackets in the expression string.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>opulse/expression/expression_evaluator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_with_all_brackets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">with_all_brackets</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets whether to include all brackets in the expression string.</span>

<span class="sd">    This method configures the behavior for generating expression strings. If set to True, it ensures that all parts of the</span>
<span class="sd">    expression that require parentheses for correct order of operations will be enclosed in brackets. This can be useful</span>
<span class="sd">    for ensuring clarity or for specific formatting requirements.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        with_all_brackets (bool): A flag indicating whether to include all necessary brackets in the expression string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">with_all_brackets</span> <span class="o">=</span> <span class="n">with_all_brackets</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="opulse.expression.expression_evaluator.ExpressionEvaluator.tree_to_str" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">tree_to_str</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">parent_op</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">with_base_symbol</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">op_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">statistic_analysis</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Converts an expression tree node to a string representation.</p>
<p>This method recursively traverses the expression tree and builds a string representation based on the node type.
For binary and unary expression nodes, it checks the operator priority relative to the parent node's operator priority
to determine if parentheses are needed to preserve correct order of operations.
For number and variable nodes, it returns their direct string representations.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>node</code>
            </td>
            <td>
                  <code><span title="expression.expression_node.ExpressionNode">ExpressionNode</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The expression node to convert.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>parent_op</code>
            </td>
            <td>
                  <code><span title="operatorplus.operator_info.OperatorInfo">OperatorInfo</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Information about the parent operator, used to determine if parentheses are needed. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>with_base_symbol</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to include base symbols in the string. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>op_mode</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A flag indicating operator mode. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>String representation of the expression node.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>NotImplementedError</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If an unsupported expression node type is encountered.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>opulse/expression/expression_evaluator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">tree_to_str</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">node</span><span class="p">:</span> <span class="n">ExpressionNode</span><span class="p">,</span>
    <span class="n">parent_op</span><span class="p">:</span> <span class="n">OperatorInfo</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">with_base_symbol</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">op_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">statistic_analysis</span><span class="p">:</span><span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts an expression tree node to a string representation.</span>

<span class="sd">    This method recursively traverses the expression tree and builds a string representation based on the node type.</span>
<span class="sd">    For binary and unary expression nodes, it checks the operator priority relative to the parent node&#39;s operator priority</span>
<span class="sd">    to determine if parentheses are needed to preserve correct order of operations.</span>
<span class="sd">    For number and variable nodes, it returns their direct string representations.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        node (ExpressionNode): The expression node to convert.</span>
<span class="sd">        parent_op (OperatorInfo, optional): Information about the parent operator, used to determine if parentheses are needed. Defaults to None.</span>
<span class="sd">        with_base_symbol (bool, optional): Whether to include base symbols in the string. Defaults to True.</span>
<span class="sd">        op_mode (bool, optional): A flag indicating operator mode. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: String representation of the expression node.</span>

<span class="sd">    Raises:</span>
<span class="sd">        NotImplementedError: If an unsupported expression node type is encountered.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Requires the priority of the parent node&#39;s operator for determining whether to add brackets</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">NumberNode</span><span class="p">):</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">NumberNode</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">op_mode</span><span class="p">:</span>
            <span class="c1"># when op_mode, we don&#39;t generate any base-related symbol</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">to_str_no_base_symbol</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">statistic_analysis</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">number_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">with_base_symbol</span><span class="p">:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">to_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">operator_manager</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">base_converter</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">to_str_no_base_symbol</span><span class="p">(</span><span class="n">surround_symbol</span><span class="o">=</span><span class="s1">&#39;$&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">VariableNode</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">BinaryExpressionNode</span><span class="p">):</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">BinaryExpressionNode</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">op_mode</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">statistic_analysis</span><span class="p">:</span>
                <span class="c1"># Statistical priority for calculating calculate_priority_hierarchical_complexity</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">priority</span> <span class="o">!=</span> <span class="kc">None</span>
                    <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">priority</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_priority</span>
                <span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">all_priority</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">priority</span><span class="p">)</span>
                <span class="c1"># Count the number of operations and associate the expression with the operator</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operation_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">all_operators</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">func_id</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># Count the n_order info</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">highest_n_order</span> <span class="o">&lt;</span> <span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">n_order</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">highest_n_order</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">n_order</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operation_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">all_operators</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">func_id</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># Convert the expression of the subtree</span>
        <span class="n">left_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_to_str</span><span class="p">(</span>
            <span class="n">node</span><span class="o">.</span><span class="n">left_expr</span><span class="p">,</span>
            <span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="p">,</span>
            <span class="n">with_base_symbol</span><span class="o">=</span><span class="n">with_base_symbol</span><span class="p">,</span>
            <span class="n">op_mode</span><span class="o">=</span><span class="n">op_mode</span><span class="p">,</span>
            <span class="n">statistic_analysis</span><span class="o">=</span><span class="n">statistic_analysis</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">right_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_to_str</span><span class="p">(</span>
            <span class="n">node</span><span class="o">.</span><span class="n">right_expr</span><span class="p">,</span>
            <span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="p">,</span>
            <span class="n">with_base_symbol</span><span class="o">=</span><span class="n">with_base_symbol</span><span class="p">,</span>
            <span class="n">op_mode</span><span class="o">=</span><span class="n">op_mode</span><span class="p">,</span>
            <span class="n">statistic_analysis</span><span class="o">=</span><span class="n">statistic_analysis</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_all_brackets</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="s1">&#39;left_bracket&#39;</span><span class="p">]</span><span class="si">}{</span><span class="n">left_str</span><span class="si">}{</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">symbol</span><span class="si">}{</span><span class="n">right_str</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="s1">&#39;right_bracket&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="c1"># self.logger.debug(f&quot;parent_op: {parent_op}&quot;)</span>
        <span class="k">if</span> <span class="n">parent_op</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">priority</span> <span class="o">&lt;</span> <span class="n">parent_op</span><span class="o">.</span><span class="n">priority</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="s1">&#39;left_bracket&#39;</span><span class="p">]</span><span class="si">}{</span><span class="n">left_str</span><span class="si">}{</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">symbol</span><span class="si">}{</span><span class="n">right_str</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="s1">&#39;right_bracket&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="n">parent_op</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">priority</span> <span class="o">==</span> <span class="n">parent_op</span><span class="o">.</span><span class="n">priority</span><span class="p">:</span>
            <span class="c1"># If it has the same priority as parent op, choose whether to add parentheses or not based on location and binding.</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">parent_op</span><span class="o">.</span><span class="n">associativity_direction</span> <span class="o">==</span> <span class="s2">&quot;left&quot;</span>
                <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="s2">&quot;right&quot;</span>
            <span class="p">):</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="s1">&#39;left_bracket&#39;</span><span class="p">]</span><span class="si">}{</span><span class="n">left_str</span><span class="si">}{</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">symbol</span><span class="si">}{</span><span class="n">right_str</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="s1">&#39;right_bracket&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="p">(</span>
                <span class="n">parent_op</span><span class="o">.</span><span class="n">associativity_direction</span> <span class="o">==</span> <span class="s2">&quot;right&quot;</span>
                <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="s2">&quot;left&quot;</span>
            <span class="p">):</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="s1">&#39;left_bracket&#39;</span><span class="p">]</span><span class="si">}{</span><span class="n">left_str</span><span class="si">}{</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">symbol</span><span class="si">}{</span><span class="n">right_str</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="s1">&#39;right_bracket&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">left_str</span><span class="si">}{</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">symbol</span><span class="si">}{</span><span class="n">right_str</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">left_str</span><span class="si">}{</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">symbol</span><span class="si">}{</span><span class="n">right_str</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">UnaryExpressionNode</span><span class="p">):</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">UnaryExpressionNode</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">op_mode</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">statistic_analysis</span><span class="p">:</span>
                <span class="c1"># Statistical priority for calculating calculate_priority_hierarchical_complexity</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">priority</span> <span class="o">!=</span> <span class="kc">None</span>
                    <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">priority</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_priority</span>
                <span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">all_priority</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">priority</span><span class="p">)</span>
                <span class="c1"># Count the number of operations and associate the expression with the operator</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operation_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">all_operators</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">func_id</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># Count the n_order info</span>
                <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">n_order</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">func_id</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">highest_n_order</span> <span class="o">&lt;</span> <span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">n_order</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">highest_n_order</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">n_order</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operation_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">all_operators</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">func_id</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">unary_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tree_to_str</span><span class="p">(</span>
            <span class="n">node</span><span class="o">.</span><span class="n">unary_expr</span><span class="p">,</span>
            <span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="p">,</span>
            <span class="n">with_base_symbol</span><span class="o">=</span><span class="n">with_base_symbol</span><span class="p">,</span>
            <span class="n">op_mode</span><span class="o">=</span><span class="n">op_mode</span><span class="p">,</span>
            <span class="n">statistic_analysis</span><span class="o">=</span><span class="n">statistic_analysis</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">unary_position</span><span class="o">==</span><span class="s1">&#39;postfix&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">unary_str</span><span class="si">}{</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">symbol</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">unary_position</span><span class="o">==</span><span class="s1">&#39;prefix&#39;</span><span class="p">:</span>
        <span class="c1"># Doubt: Always choose to add brackets to unary</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">symbol</span><span class="si">}{</span><span class="n">unary_str</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;ExpressionEvaluator.tree_to_str&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Opulse Team
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
    
  </body>
</html>